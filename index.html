<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTH Attendance Calculator</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 10px; 
            background: #f5f5f5; 
        }
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            width: 100%;
        }
        h1 { 
            color: #333; 
            text-align: center; 
            font-size: 1.5rem;
            margin: 10px 0;
        }
        .info { 
            background: #e3f2fd; 
            padding: 12px; 
            border-radius: 5px; 
            margin: 15px 0; 
            font-size: 0.9rem;
            word-break: break-word;
        }
        .input-group { margin: 15px 0; }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
            color: #555; 
            font-size: 0.95rem;
        }
        input { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            font-size: 16px;
        }
        button { 
            width: 100%; 
            padding: 14px; 
            background: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 16px; 
            margin-top: 10px; 
        }
        button:hover { background: #45a049; }
        .result { 
            margin-top: 20px; 
            padding: 15px; 
            background: #f9f9f9; 
            border-radius: 5px; 
            border-left: 4px solid #4CAF50; 
        }
        .result h3 { 
            margin-top: 0; 
            color: #333; 
            font-size: 1.2rem;
        }
        .result p { 
            margin: 8px 0; 
            color: #666; 
            font-size: 0.95rem;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow-x: auto;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .stats-table th {
            padding: 10px 8px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #555;
            border-right: 1px solid #e0e0e0;
            background: #f5f5f5;
            text-align: center;
        }
        .stats-table th:last-child {
            border-right: none;
        }
        .stats-table td {
            padding: 12px 8px;
            font-size: 0.9rem;
            font-weight: bold;
            color: #333;
            border-right: 1px solid #e0e0e0;
            text-align: center;
        }
        .stats-table td:last-child {
            border-right: none;
        }
        .stats-table td.highlight {
            background: #e8f5e9;
            color: #2e7d32;
            font-size: 1rem;
        }
        .status { 
            font-weight: bold; 
            font-size: 1rem; 
            line-height: 1.5;
        }
        .pass { color: #4CAF50; }
        .fail { color: #f44336; }
        .calendar { margin-top: 20px; }
        .calendar h4 { 
            color: #333; 
            margin-bottom: 10px; 
            font-size: 1.1rem;
        }
        .calendar-grid { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            gap: 3px; 
        }
        .calendar-day { 
            padding: 8px 4px; 
            text-align: center; 
            border-radius: 4px; 
            font-size: 0.75rem; 
            min-height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .calendar-header { 
            font-weight: bold; 
            background: #e3f2fd; 
            padding: 8px 4px; 
            font-size: 0.8rem;
        }
        .available { background: #c8e6c9; color: #2e7d32; font-weight: bold; }
        .suggested { background: #81c784; color: #1b5e20; font-weight: bold; border: 2px solid #2e7d32; }
        .weekend { background: #ffccbc; color: #d84315; }
        .holiday { background: #fff9c4; color: #f57f17; }
        .past { background: #e0e0e0; color: #757575; }
        .legend { 
            margin-top: 15px; 
            font-size: 0.75rem; 
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .legend span {
            padding: 4px 8px;
            border-radius: 3px;
            white-space: nowrap;
        }

        /* Tablet and larger */
        @media (min-width: 768px) {
            body { padding: 30px; }
            .container { padding: 40px; }
            h1 { font-size: 2rem; }
            .calendar-day { 
                padding: 10px; 
                font-size: 0.85rem; 
                min-height: 60px;
            }
            .calendar-header { font-size: 0.9rem; }
            .legend { font-size: 0.85rem; }
        }

        /* Desktop */
        @media (min-width: 1024px) {
            body { padding: 50px; }
            h1 { font-size: 2.2rem; }
            .info { font-size: 1rem; }
            .result p { font-size: 1rem; }
            .stats-table th { padding: 12px 10px; font-size: 0.85rem; }
            .stats-table td { padding: 14px 10px; font-size: 1rem; }
            .status { font-size: 1.1rem; }
            .calendar-day { 
                padding: 12px; 
                font-size: 0.9rem; 
                min-height: 70px;
            }
            .calendar-header { font-size: 1rem; }
            .legend { font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÖ DTH Attendance Calculator</h1>
        
        <div class="info">
            <strong>Current Date & Time (IST):</strong> <span id="currentDateTime"></span>
        </div>

        <div class="input-group">
            <label for="month">Select Month:</label>
            <input type="month" id="month" required>
        </div>

        <div class="input-group">
            <label for="daysAttended">Days Attended So Far (Optional):</label>
            <input type="number" id="daysAttended" min="0" value="" placeholder="Leave empty for future planning">
        </div>

        <div class="input-group">
            <label for="leaves">Number of Leaves Taken:</label>
            <input type="number" id="leaves" min="0" value="0" required>
        </div>

        <button onclick="calculateAttendance()">Calculate Attendance</button>

        <div id="result" style="display: none;" class="result"></div>
    </div>

    <script>
        const holidays = {
            2025: [
                { date: '2025-01-01', name: 'New Year Day' },
                { date: '2025-01-14', name: 'Makara Sankranti' },
                { date: '2025-03-13', name: 'Holi Feast' },
                { date: '2025-03-31', name: 'Qutub-e-Ramzan' },
                { date: '2025-04-18', name: 'Good Friday' },
                { date: '2025-05-01', name: 'May day' },
                { date: '2025-08-15', name: 'Independence day' },
                { date: '2025-08-27', name: 'Ganesh Chaturthi' },
                { date: '2025-09-05', name: 'Id-Meelad / Tiru Onam' },
                { date: '2025-10-01', name: 'Ayudha Puja/ Vijayadashami' },
                { date: '2025-10-02', name: 'Gandhi Jayanti' },
                { date: '2025-10-20', name: 'Naraka Chaturdashi' },
                { date: '2025-10-21', name: 'Deepavali' },
                { date: '2025-12-25', name: 'Christmas' }
            ],
            2026: [
                { date: '2026-01-01', name: 'New Year Day' },
                { date: '2026-01-15', name: 'Makara Sankranti' },
                { date: '2026-01-26', name: 'Republic Day' },
                { date: '2026-03-19', name: 'Chandramana Ugadi' },
                { date: '2026-04-03', name: 'Good Friday' },
                { date: '2026-05-01', name: 'May day' },
                { date: '2026-05-28', name: 'Bakrid / Eid al-Adha' },
                { date: '2026-08-26', name: 'Id-Meelad / Tiru Onam' },
                { date: '2026-09-14', name: 'Ganesh Chaturthi' },
                { date: '2026-10-02', name: 'Gandhi Jayanti' },
                { date: '2026-10-21', name: 'Vijayadashami' },
                { date: '2026-11-09', name: 'Naraka Chaturdashi' },
                { date: '2026-11-10', name: 'Balipadyami Deepavali' },
                { date: '2026-12-25', name: 'Christmas' }
            ]
        };

        function updateDateTime() {
            const now = new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
            document.getElementById('currentDateTime').textContent = now;
        }

        function isWeekend(date) {
            const day = date.getDay();
            return day === 0 || day === 6;
        }

        function isHoliday(date, year) {
            const dateStr = date.toISOString().split('T')[0];
            const yearHolidays = holidays[year] || [];
            return yearHolidays.some(h => h.date === dateStr);
        }

        function calculateAttendance() {
            const monthInput = document.getElementById('month').value;
            const daysAttendedInput = document.getElementById('daysAttended').value;
            const daysAttended = daysAttendedInput ? parseInt(daysAttendedInput) : 0;
            const leaves = parseInt(document.getElementById('leaves').value) || 0;

            if (!monthInput) {
                alert('Please select a month');
                return;
            }

            const [year, month] = monthInput.split('-').map(Number);
            const today = new Date();
            const todayIST = new Date(today.toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }));
            
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            
            let totalDays = 0;
            let weekends = 0;
            let holidaysCount = 0;
            let pastWorkingDays = 0;
            let futureWorkingDays = 0;
            
            for (let d = new Date(firstDay); d <= lastDay; d.setDate(d.getDate() + 1)) {
                totalDays++;
                const isPast = d <= todayIST;
                
                if (isWeekend(d)) {
                    weekends++;
                } else if (isHoliday(d, year)) {
                    holidaysCount++;
                } else {
                    if (isPast) {
                        pastWorkingDays++;
                    } else {
                        futureWorkingDays++;
                    }
                }
            }

            const totalWorkingDays = totalDays - weekends - holidaysCount - leaves;
            const mandatoryDays = Math.ceil(totalWorkingDays * 0.5);
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            
            // Always show detailed current status
            if (true) {
                const currentAttendance = ((daysAttended / totalWorkingDays) * 100).toFixed(2);
                const daysNeeded = Math.max(0, mandatoryDays - daysAttended);
                const canAchieve = daysNeeded <= futureWorkingDays;
                
                let statusMessage = '';
                let statusClass = '';
                
                if (daysAttended >= mandatoryDays) {
                    statusMessage = '‚úÖ PASS - You have already met the 50% requirement!';
                    statusClass = 'pass';
                } else if (canAchieve) {
                    statusMessage = `‚ö†Ô∏è You need to attend ${daysNeeded} more day(s) to reach 50%. ${futureWorkingDays} working day(s) remaining.`;
                    statusClass = 'fail';
                } else {
                    statusMessage = `‚ùå FAIL - You need ${daysNeeded} more day(s) but only ${futureWorkingDays} working day(s) left. Cannot achieve 50%!`;
                    statusClass = 'fail';
                }

                const calendarHTML = generateCalendar(year, month, todayIST, daysNeeded);
                
                resultDiv.innerHTML = `
                    <h3>üìä Attendance Report for ${new Date(year, month - 1).toLocaleString('default', { month: 'long', year: 'numeric' })}</h3>
                    <table class="stats-table">
                        <tr>
                            <th>üìÖ Total Days</th>
                            <th>üèñÔ∏è Weekends</th>
                            <th>üéâ Holidays</th>
                            <th>üè† Leaves</th>
                            <th>üíº Working Days</th>
                            <th>‚èÆÔ∏è Past Days</th>
                            <th>‚è≠Ô∏è Future Available</th>
                            <th>‚úÖ Attended</th>
                            <th>üìà Attendance</th>
                            <th>üéØ Mandatory</th>
                            <th>‚ö° Needed</th>
                        </tr>
                        <tr>
                            <td>${totalDays}</td>
                            <td>${weekends}</td>
                            <td>${holidaysCount}</td>
                            <td>${leaves}</td>
                            <td class="highlight">${totalWorkingDays}</td>
                            <td>${pastWorkingDays}</td>
                            <td>${futureWorkingDays}</td>
                            <td>${daysAttended}</td>
                            <td class="highlight">${currentAttendance}%</td>
                            <td>${mandatoryDays}</td>
                            <td class="highlight">${daysNeeded}</td>
                        </tr>
                    </table>
                    <p class="status ${statusClass}">
                        ${statusMessage}
                    </p>
                    ${calendarHTML}
                `;
                
                // Smooth scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            } else {
                // Show future planning report
                const calendarHTML = generateCalendar(year, month, todayIST, mandatoryDays);
                
                resultDiv.innerHTML = `
                    <h3>üìä Attendance Planning for ${new Date(year, month - 1).toLocaleString('default', { month: 'long', year: 'numeric' })}</h3>
                    <table class="stats-table">
                        <tr>
                            <th>üìÖ Total Days</th>
                            <th>üèñÔ∏è Weekends</th>
                            <th>üéâ Holidays</th>
                            <th>üè† Leaves</th>
                            <th>üíº Working Days</th>
                            <th>üéØ Mandatory (50%)</th>
                            <th>‚è≠Ô∏è Future Days</th>
                        </tr>
                        <tr>
                            <td>${totalDays}</td>
                            <td>${weekends}</td>
                            <td>${holidaysCount}</td>
                            <td>${leaves}</td>
                            <td class="highlight">${totalWorkingDays}</td>
                            <td class="highlight">${mandatoryDays}</td>
                            <td>${futureWorkingDays}</td>
                        </tr>
                    </table>
                    <p class="status pass">
                        üìÖ You need to attend at least ${mandatoryDays} days out of ${totalWorkingDays} working days to meet 50% requirement.
                    </p>
                    ${calendarHTML}
                `;
                
                // Smooth scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }

        function generateCalendar(year, month, todayIST, daysToHighlight = 0) {
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const startDay = firstDay.getDay();
            
            // Helper: Check if date is near holiday (within 1 day)
            function isNearHoliday(day) {
                for (let offset = -1; offset <= 1; offset++) {
                    const checkDate = new Date(year, month - 1, day + offset);
                    if (isHoliday(checkDate, year)) return true;
                }
                return false;
            }
            
            // Collect available dates grouped by week
            let weeklyDates = {};
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month - 1, day);
                const isPast = date < todayIST;
                const isWeekendDay = isWeekend(date);
                const isHolidayDay = isHoliday(date, year);
                const nearHoliday = isNearHoliday(day);
                
                if (!isPast && !isWeekendDay && !isHolidayDay && !nearHoliday) {
                    const weekNum = Math.floor((day + startDay - 1) / 7);
                    if (!weeklyDates[weekNum]) weeklyDates[weekNum] = [];
                    weeklyDates[weekNum].push(day);
                }
            }
            
            // Select 3 days per week, spread across weeks
            let suggestedDays = new Set();
            if (daysToHighlight > 0) {
                const weeks = Object.keys(weeklyDates).sort((a, b) => a - b);
                let remaining = daysToHighlight;
                
                for (let week of weeks) {
                    if (remaining <= 0) break;
                    const daysInWeek = weeklyDates[week];
                    const toSelect = Math.min(3, remaining, daysInWeek.length);
                    
                    // Select evenly spaced days in the week
                    const step = Math.max(1, Math.floor(daysInWeek.length / toSelect));
                    for (let i = 0; i < toSelect; i++) {
                        suggestedDays.add(daysInWeek[i * step]);
                        remaining--;
                    }
                }
            }
            
            let calendarHTML = `
                <div class="calendar">
                    <h4>üìÖ Available Days Calendar</h4>
                    <div class="calendar-grid">
                        <div class="calendar-header">Sun</div>
                        <div class="calendar-header">Mon</div>
                        <div class="calendar-header">Tue</div>
                        <div class="calendar-header">Wed</div>
                        <div class="calendar-header">Thu</div>
                        <div class="calendar-header">Fri</div>
                        <div class="calendar-header">Sat</div>
            `;
            
            // Empty cells before first day
            for (let i = 0; i < startDay; i++) {
                calendarHTML += '<div class="calendar-day"></div>';
            }
            
            // Days of month
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month - 1, day);
                const isPast = date < todayIST;
                const isWeekendDay = isWeekend(date);
                const isHolidayDay = isHoliday(date, year);
                
                let className = 'calendar-day';
                let label = '';
                
                if (isPast) {
                    className += ' past';
                    label = '(Past)';
                } else if (isWeekendDay) {
                    className += ' weekend';
                    label = '(Weekend)';
                } else if (isHolidayDay) {
                    className += ' holiday';
                    const holidayName = holidays[year].find(h => h.date === date.toISOString().split('T')[0])?.name || '';
                    label = `(${holidayName})`;
                } else if (suggestedDays.has(day)) {
                    className += ' suggested';
                    label = '‚≠ê';
                } else {
                    className += ' available';
                    label = '‚úì';
                }
                
                calendarHTML += `<div class="${className}" title="${label}">${day}<br><small>${label}</small></div>`;
            }
            
            calendarHTML += `
                    </div>
                    <div class="legend">
                        <span style="background: #81c784; border: 2px solid #2e7d32;">‚≠ê Suggested</span>
                        <span style="background: #c8e6c9;">‚úì Available</span>
                        <span style="background: #ffccbc;">Weekend</span>
                        <span style="background: #fff9c4;">Holiday</span>
                        <span style="background: #e0e0e0;">Past</span>
                    </div>
                </div>
            `;
            
            return calendarHTML;
        }

        // Set current month as default
        const now = new Date();
        document.getElementById('month').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
        
        // Update time every second
        updateDateTime();
        setInterval(updateDateTime, 1000);
    </script>
</body>
</html>
